---
layout:     post
title:      "走进计算机组成原理（三）"
subtitle:   "中央处理器"
date:       2016-12-14 18:00:00
author:     "林佩勤"
header-img: "img/post-bg.jpg"
tags:
    - 计算机组成原理
---

> 计算机组成原理第三站


## 前言

本文接着上一篇，讲一讲计算机系统的硬件结构。

---

## 正文

#### 系统总线

**集中式总线控制**

- 链式查询：对电路故障最敏感。在链式查询下，若有N个设备，则只有一条总线请求线。
- 计数器定时查询：优先级设置较灵活，对电路故障不敏感。若每次计数从上一次计数的终止点开始，则每个设备使用总线的机会相等；若计数从0开始，则设备号小的优先级高。
- 独立请求：响应时间最快，以增加控制线数为代价。对于独立请求，有N个总线请求信号和N个总线响应信号。

**总线通信方式**

- 同步通信：特点为**通信双方由统一时钟控制数据的传输**，一般用于**总线长度较短，总线上各部件存取时间比较一致的**。同步通信中，一个总线周期的传输过程是先传输地址，后传输数据。总线同步通信影响总线效率的原因是**必须要按最慢速度的部件来设计公共时钟**
- 异步通信：特点为**通信双方没有公共的时钟标准，采用应答方式通信**，一般用于**总线上各部件速度不一致的**。不采用时钟信号，只采用握手信号。异步通信方式包括不互锁、半互锁和全互锁，其中不互锁速度最快。
- 半同步通信：既采用时钟信号，又采用握手信号。

**其他知识点**

- 总线通常可分为片内总线、系统总线和通信总线。
- 系统总线是连接**CPU、主存、I/O**之间的信息传送线，按传输内容不同，可分为**数据总线**、**地址总线**、**控制总线**，分别用来传送**数据**、**地址**和**控制信号、响应信号和时序信号**
- PCI总线具有即插即用的功能，是与处理器时间频率无关的高速外围总线。
- 一个总线传输周期包括**申请分配阶段**、**寻址阶段**、**传输阶段**和**结束阶段**
- 每个总线部件一般都配有**三态门**电路，以避免总线访问冲突。

#### 存储器

**知识点盘点**

- 存取周期和存取时间的主要区别是：存取时间仅为完成一次操作的时间，而存取周期指存储器进行连续读或写操作所允许的最短间隔时间，它不仅包含操作时间，还包含操作后线路的恢复时间。即：存取周期=存取时间+恢复时间。

- 磁盘是部分串行存取，磁带是串行存取。

- 磁盘存储器的等待时间通常指磁盘旋转半周所需的时间。平均等待时间和磁盘转速有关，它用磁盘旋转一周所需时间的一半来表示通常，采用平均等待时间来表示，平均等待时间为磁盘旋转半圈所需要的时间。磁盘上的磁道是记录密度不同的同心圆，内部同心圆与外部同心圆的存储数据量相等。磁盘的查找时间指使磁头移动到要找的柱面上所需的时间。

- 活动头磁盘存储器的寻道时间通常是指最大寻道时间和最小寻道时间的平均值。活动头磁盘存储中，信息写入或读出磁盘是**串行方式**进行的。

- 相联存储器与传统存储器的主要区别是前者又叫按**内容**寻址的存储器。

- 常用的虚拟存储器寻址系统由**主存—辅存**两级存储器组成。虚拟存储管理系统的基础是程序访问的局部性理论，此理论的基本含义是在程序的执行过程中，程序对主存的访问是不均匀的。

- Cache命中率与Cache块的大小、Cache的容量、Cache中与主存映射方式以及Cache替换算法有关，与主存存取时间无关。

- 主存和Cache有三种地址映像方式：直接映像（Cache的某一块只能和固定的一些主存块建立映像关系，主存的某一块只能对应一个Cache块，若Cache的容量为n块，则第i块映像到缓存第i%n块）、全相联映像（Cache的某一块可以和任一主存块建立映像关系，而主存中某一块也可以映像到Cache中任一块位置上，常采用相联存储器实现，灵活性强，成本最高）和组相联映像（组间直接映像，而组内全相联映像）。 

- Cache、主存和辅存组成三级存储系统。主存可以和**缓存**、**辅存**和**CPU**交换信息，辅存可以和**主存**交换信息，快速缓存可以和**主存**、**CPU**交换信息。

- DRAM刷新的方法包括集中式、分散式、异步式。刷新是由于**存储电荷的电容放电**

- 层次化存储器结构设计的依据是**程序访问的局部性**原理。

- 汉明码（海明码）校验：

  > 1. 计算校验位数：设m=数据位数，k=校验位数位，n=总编码位数＝m+k，有Hamming不等式
  >
  >    ![img](http://img.blog.csdn.net/20130903102558203?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYTc0N2x1bHU3NDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
  >
  > 2. 确定校验码位置：校验码**必须**是在2n次方位置，如第1、2、4、8、16、32，……位（对应20、21、22、23、24、25，……，是从最左边的位数起的），这样一来就知道了信息码的分布位置，也就是非2n次方位置，如第3、5、6、7、9、10、11、12、13，……位（是从最左边的位数起的）。
  >
  > 3. 确定校验码
  >
  >    p1（第1个校验位，也是整个码字的第1位）的校验规则是：从当前位数起，校验1位，然后跳过1位，再校验1位，再跳过1位，……。这样就可得出p1校验码位可以校验的码字位包括：第1位（也就是p1本身）、第3位、第5位、第7位、第9位、第11位、第13位、第15位，……。然后根据所采用的是奇校验，还是偶校验，最终可以确定该校验位的值。
  >
  >    p2（第2个校验位，也是整个码字的第2位）的校验规则是：从当前位数起，连续校验2位，然后跳过2位，再连续校验2位，再跳过2位，……。这样就可得出p2校验码位可以校验的码字位包括：第2位（也就是p2本身）、第3位，第6位、第7位，第10位、第11位，第14位、第15位，……。同样根据所采用的是奇校验，还是偶校验，最终可以确定该校验位的值。
  >
  >    p3（第3个校验位，也是整个码字的第4位）的校验规则是：从当前位数起，连续校验4位，然后跳过4位，再连续校验4位，再跳过4位，……。这样就可得出p4校验码位可以校验的码字位包括：第4位（也就是p4本身）、第5位、第6位、第7位，第12位、第13位、第14位、第15位，第20位、第21位、第22位、第23位，……。同样根据所采用的是奇校验，还是偶校验，最终可以确定该校验位的值。
  >
  >    ……
  >
  >    我们把以上这些校验码所校验的位分成对应的组，它们在接收端的校验结果（通过对各校验位进行逻辑“异或运算”得出）对应表示为G1、G2、G3、G4，……，正常情况下均为0。
  >
  >    举例子来说明，码字为？？1 ？0 0 1？1 1 0 1。
  >
  >    先求第1个“？”（也就是p1，第1位）的值，因为整个码字长度为12（包括信息码长和校验码长），所以可以得出本示例中p1校验码校验的位数是1、3、5、7、9、11共6位。这6位中除了第1位（也就是p1位）不能确定外，其余5位的值都是已知的，分别为：1、0、1、1、0。现假设采用的是偶校验（也就是要求整个被校验的位中的“1”的个数为偶数），从已知的5位码值可知，已有3个“1”，所以此时p1位校验码的值必须为“1”，得出p1=1。
  >
  >    再求第2个“？”（也就是p2，第2位）的值，根据以上规则可以很快得出本示例中p2校验码校验的位数是2、3、6、7、10、11，也是一共6位。这6位中除了第2位（也就是p2位）不能确定外，其余5位的值都是已知的，分别为：1、0、1、1、0。现假设采用的是偶校验，从已知的5位码值可知，也已有3个“1”，所以此时p2位校验码的值必须为“1”，得出p2=1。
  >
  >    再求第3个“？”（也就是p3，第4位）的值，根据以上规则可以很快得出本示例中p3校验码校验的位数是4、5、6、7、12，一共5位。这5位中除了第4位（也就是p3位）不能确定外，其余4位的值都是已知的，分别为：0、0、1、1。现假设采用的是偶校验，从已知的4位码值可知，也已有2个“1”，所以此时p2位校验码的值必须为“0”，得出p3=0。
  >
  >    最后求第4个“？”（也就是p4，第8位）的值，根据以上规则可以很快得出本示例中p4校验码校验的位数是8、9、10、11、12（本来是可以连续校验8位的，但本示例的码字后面的长度没有这么多位，所以只校验到第12位止），也是一共5位。这5位中除了第8位（也就是p4位）不能确定外，其余4位的值都是已知的，分别为：1、1、0、1。现假设采用的是偶校验，从已知的4位码值可知，已有3个“1”，所以此时p2位校验码的值必须为“1”，得出p4=1。
  >
  >    最后就可以得出整个码字的各个二进制值码字为：11**1**0**001**1**1101**（带阴影的4位就是校验码）。

**例题讲解**

Q：一个容量为16K×32位的存储器，其地址线和数据线总和是多少？当选用下列不同规格的存储芯片时，各需要多少片？ 1K×4位，2K×8位，4K×4位，16K×1位，4K×8位，8K×8位

A：地址线和数据线的总和 = 14 + 32 = 46根；选择不同的芯片时，各需要的片数为：

- 1K×4：（16K×32） / （1K×4） = 16×8 = 128片
- 2K×8：（16K×32） / （2K×8） = 8×4 = 32片
- 4K×4：（16K×32） / （4K×4） = 4×8 = 32片
- 16K×1：（16K×32）/ （16K×1） = 1×32 = 32片
- 4K×8：（16K×32）/ （4K×8） = 4×4 = 16片
- 8K×8：（16K×32） / （8K×8） = 2×4 = 8片

Q：一个512KB的存储器，其地址线和数据线的总和是？

A：512KB=2的19次方，则地址线有19根。数据线要看是几位机，一般是8位，8位就是8根线，故总共27条线。

Q：某计算机字长16位，它的存储容量是64KB，按字编址，它的寻址范围是？

A：64KB/16位=32K，所以寻址范围是0-32K-1。

Q：某一RAM芯片其容量是512*8位，除电源和接地端外，该芯片引线的最少数目是多少？

A：这道题没有一个统一无争议的答案，先说通俗答案，再提出异议。

通俗答案是9根地址线(2^9=512)、8根数据线，1根片选线，1根读写线，共19根。

异议：读写线有时可以用1根，有时可以用2根（读一根、写一根）。

若RAM是动态RAM，如果采用地址复用技术，通过行通选和列通选分行列两次传送地址信号，故而地址线减半为5根，数据线不变，控制线变成1根行通选、1根列通选以及读写控制线（可用1根可用2根），片选线用行通选代替，总数是……可以自己加着看看这道题争议极大，暂没有什么比较正规的答案。

Q：磁盘转速提高一倍，则____	A．平均查找时间缩小一半	B．其存取速度也提高一倍	C．不影响查找时间

A：寻道速度和读写（数据传输）速度不是一个概念，寻道是指磁头从一个磁道到另一个磁道，相当于磁头做圆的径向运动，而读写磁道是沿圆周运动。因此磁盘转速提高只是提高了读写（数据传输）速度，而磁头的摆动速度并没有提高。另外存取时间=寻道时间+旋转延迟+传输时间。故本题选C。

Q：写出1100、1101、1110、1111对应的汉明码。

A：有效信息均为n=4位，假设有效信息用b4b3b2b1表示，可得校验位位数k=3位

设校验位分别为c1、c2、c3，则汉明码共4+3=7位，即：c1c2b4c3b3b2b1 

校验位在汉明码中分别处于第1、2、4位，则有c1=b4⊕b3⊕b1，c2=b4⊕b2⊕b1，c3=b3⊕b2⊕b1 

当有效信息为1100时，c3c2c1=011,汉明码为1110100。 当有效信息为1101时，c3c2c1=100,汉明码为0011101。 当有效信息为1110时，c3c2c1=101,汉明码为1011110。 当有效信息为1111时，c3c2c1=010,汉明码为0110111。

Q：已知收到的汉明码（按配偶原则配置）为1100100、1100111、1100000、1100001，检查上述代码是否出错？第几位出错？

A：假设接收到的汉明码为：c1’c2’b4’c3’b3’b2’b1’ 

纠错过程如下： P1=c1’⊕b4’⊕b3’⊕b1’，P2=c2’⊕b4’⊕b2’⊕b1’，P3=c3’⊕b3’⊕b2’⊕b1’ 

如果收到的汉明码为1100100，则p3p2p1=011，说明代码有错，第3位（b4’）出错，有效信息为：1100 

如果收到的汉明码为1100111，则p3p2p1=111，说明代码有错，第7位（b1’）出错，有效信息为：0110 

如果收到的汉明码为1100000，则p3p2p1=110，说明代码有错，第6位（b2’）出错，有效信息为：0010 

如果收到的汉明码为1100001，则p3p2p1=001，说明代码有错，第1位（c1’）出错，有效信息为：0001

#### 输入输出系统

**I/O设备与主机信息传送的控制方式**

- 程序查询方式：这种方式控制简单，但外设和主机不能同时工作，各外设之间也不能同时工作，系统效率很低，因此，仅适用于外设的数目不多，对I/O处理的实时要求不那么高，CPU的操作任务比较单一，并不很忙的情况。若主机和设备是串行工作的，那传送数据时用这种方式。
- 程序中断方式：CPU和设备并行工作，传送与主程序串行工作。键盘每按键一次，或鼠标点击一次，都会产生中断，称为按键中断。中断向量地址是中断服务程序入口地址的地址，中断接口电路通过**数据**总线将向量地址送至CPU。
- 直接存储器存取方式(DMA)：CPU和设备并行工作，传送与主程序并行工作。效率最高。在微型机系统中，主机和高速硬盘进行数据交换一般采用**DMA**方式。采用DMA方式传送数据时，每传送一个数据要占用**一个存储周期**的时间。周期挪用（窃取）方式常用于DMA中，在DMA中，周期窃取是窃取一个存取周期。DMA方式不能取代中断方式。程序中断方式和DMA方式中都有中断请求，但目的不同。
- I/O通道方式：通道程序是由通道控制字组成的。CPU程序和通道程序可以并行执行，并通过**I/O指令和I/O中断**实现彼此间的通信和同步。通道对CPU的请求形式是中断，而CPU对通道的请求方式是I/O指令。
- I/O处理机方式

**I/O设备编址方式**

- 独立编址：存储器和I/O端口在两个独立的地址空间中。
- 统一编址：存储器和I/O端口共用统一的地址空间，当一个地址空间分配给I/O端口以后，存储器就不能再占有这一部分的地址空间。在**单总线**的计算机系统中，外设可以和主存单元统一编址，因此可以不使用I/O指令。

**并串转换和串并转换**

这种转换常用**移位寄存器**实现，可以用软件实现，不一定要用硬件实现。

**外部设备分类**

- 人机交互设备：键盘、鼠标、显示器、打印机等；
- 计算机信息驻留设备：磁盘、磁带、光盘等；
- 机机通信设备：调制解调器等。

**ASCII码、BCD码和奇偶校验码**

- ASCII码：由7位二进制码组成。
- BCD码：用4位二进制代码表示一位十进制数。
- 奇偶校验码：为了校验编码的正确性，在被传送的n位代码上增加一位检验位，并使其配置后的n+1位代码中“1”的个数为奇数，则称其为奇校验；若配置后“1”的个数为偶数，则称其为偶校验。

## 后记

这一篇相对于前一篇知识点更为复杂，需要耐下心来学习。
