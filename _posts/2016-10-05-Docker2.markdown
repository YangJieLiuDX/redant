---
layout:     post
title:      "Docker再入门"
subtitle:   "走进Docker的世界"
date:       2016-10-05 02:00:00
author:     "林佩勤"
header-img: "img/post-bg.jpg"
tags:
    - Docker
    - 云计算
---

> “Knockin' On Docker's Door”


## 前言

本文接着上一篇文章，继续讲讲Docker的知识点。

---

## 正文

此文开头先摆出解决从官方，即Docker Hub中，拉取镜像不成功且速度慢的问题。对于这个问题，我们可以用DaoCloud提供的Docker加速器解决。解决步骤如下:


    注册成为DaoCloud用户；

    登录进入DaoCould用户的控制台页面；

    选择"加速器",按操作进行；

sudo service docker restart。

紧接着我们讲讲构建镜像，

构建镜像的两种方法：

    使用docker commit 命令
    使用docker build命令和Dockerfile文件

Dockerfile更抢到、灵活，推荐使用。

一般来说不是真的“创建”新镜像，而是基于一个已有的基础镜像，比如Ubuntu、Fedora等，构建新的镜像而已。

### 用commit构建镜像

去[Docker Hub](https://hub.docker.com/account/signup/)上创建帐号

docker login进行登录

注：如果登录不成功的话，百分之九十是GFW的问题，可以查看https://github.com/docker/docker/issues/3203解决

接下来可以做一些修改（如安装软件等，当然这里可能无法安装，因为网络的问题），然后就可以commit了

sudo docker commit 614122c0aabb aoct/test

查看新创建的镜像：

$ sudo docker images aoct/test

也可以像git一样，在提交镜像时指定更多信息来描述所做的修改：

$ sudo docker commit -m='A new image' --author='Aomine' 614122c0aabb aoct/apache2

查看新创建的镜像的详细信息：

sudo docker inspect aoct/apache2

使用docker run命令从刚创建的新镜像运行一个容器：

$ sudo docker run -t -i aoct/apache2 /bin/bash

需要的话可以docker push上去



Dockerfile

使用 docker commit 来扩展一个镜像比较简单,但是不方便在一个团队中分享。我们可以使用 docker build
来创建一个新的镜像。为此,首先需要创建一个 Dockerfile,包含一些如何创建镜像的指令。

Dockerfile使用Dockerfile 中每一条指令都创建镜像的一层,例如:

// 提交镜像修改sudo docker commit -m "Added json gem"// 推送项目sudo docker push ouruser/sinatra

# This is a comment

FROM ubuntu:14.04MAINTAINER Docker Newbee [newbee@docker.com](mailto:newbee@docker.com)RUN apt-get -qq updateRUN apt-get -qqy install ruby ruby-devRUN gem install sinatraDockerfile 基本的语法是 * 使用 # 来注释 * FROM 指令告诉 Docker 使用哪个镜像作为基础 * 接着是维护者的信息 * RUN 开头的指令会在创建中运行,比如安装一个软件包,在这里使用 apt-get 来安装了一些软件编写完成 Dockerfile 后可以使用 docker build 来生成镜像。$ sudo docker build -t="ouruser/sinatra:v2"

https://segmentfault.com/a/1190000002567459

有时候使用 Docker Hub 这样的公共仓库可能不方便,用户可以创建一个本地仓库供私人使用。

在安装了 Docker 后,可以通过获取官方 registry 镜像来运行。
$ sudo docker run -d -p 5000:5000 registry

列出镜像
docker images

重新标记一个本地镜像为私有仓库的版本，这里将本地的ubuntu 12.04标记为localhost:5000/ubuntu:1204。
	
docker tag ubuntu:12.04 localhost:5000/ubuntu:1204

将本地镜像推送到本地仓库中
	
docker push localhost:5000/ubuntu:1204

查看本地仓库中的镜像列表
	
curl http://localhost:5000/v2/ubuntu/tags/list

***数据卷***
数据卷是一个可供一个或多个容器使用的特殊目录，用于共享和重用。

1.1、添加一个数据卷

可以使用带有 -v 参数的 Docker run 命令给容器添加一个数据卷.
[root@localhost ~]# docker run -ti -v /data centos /bin/bash 

使用 -v 标记也可以指定挂载一个本地主机的目录到容器中去。
$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py
上面的命令加载主机的 /src/webapp 目录到容器的 /opt/webapp 目录。

-v 标记也可以从主机挂载单个文件到容器中
$ sudo docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash

## 后记

这一次的后记就闲聊一下前言提到的考研吧，算是首尾呼应吧！考研是这个暑假实习期间下的决心，本来一开始上大学的时候，是不打算继续深造的，一来觉得必要性不大，二来是自己对学习这东西有点爱恨交加。不过随着对这个专业的深入了解，最终做了考研的打算（其实在实习前还是犹豫不决）。

决定了考研，却什么都还没准备，便趁着国庆期间上网查查建议。期间有人吐槽国内计算机考研环境不好，也让自己动摇了决定。最后还是听从一些人的建议，实际上应该是听从自己的内心，决定静下心来，好好备考，无论最好是考不上还是改变主意，也都会有所收获。
