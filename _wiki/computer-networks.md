---
layout: wiki
title: Computer Networks
categories: Computer Networks
description: 计算机网络
keywords: 计算机网络
---

### 第 1 章 概述

#### 1.1 什么是计算机网络

计算机网络，是指将地理位置不同的具有独立功能的多台计算机及其外部设备，通过通信线路连接起来，在网络操作系统，网络管理软件及网络通信协议的管理和协调下，实现资源共享和信息传递的计算机系统。计算机网络向用户提供的最重要的两个功能是：连通性和共享。

#### 1.2 计算机网络组成

##### 1.2.1 逻辑组成

从逻辑上讲，计算机网络是由通信子网和资源子网组成的。通信子网由网络节点和通信链路组成，提供网络服务；而资源子网由主机、终端控制器和终端组成，提供访问网站和处理数据的服务。

##### 1.2.2 物理组成

从物理上讲，计算机网络是由网络硬件和网络软件组成的。网络硬件提供的是数据处理、数据传输和建立通信通道的物质基础，它包括拓扑结构、网络服务器、网络工作站、传输介质和网络设备等；而网络软件是真正控制数据通信的，它包括网络操作系统、通信软件和通讯协议等，软件的各种网络功能需依赖于硬件去完成。

#### 1.3 计算机网络类别

##### 1.3.1 按覆盖范围分类

计算机网络按照其作用的范围大小可分为局域网（LAN，Local Area Network）、城域网（MAN，Metropolitan Area Network）和广域网（Wan，Wide Area Network）。

- 局域网是连接近距离计算机的网络，覆盖范围从几米到数公里，其分布范围局限在一个办室、一幢大楼或一个校园内，用于连接个人计算机、工作站和各类外围设备以实现资源共享和信息交换。在历经了链式局域网、令牌环与 AppleTalk 等技术后，以太网和无线网络连接是现今局域网中最常用的两项技术
- 城域网的目标是满足几十公里范围内的大量企业、机关和公司等的多个局域网互连的需求。其本质上也是一种大型的局域网，所以它通常使用与局域网相似的技术，把它列为单独的一类主要是因为它有独立的标准而且已经被应用了
- 广域网覆盖的地理范围可从几十公里到几千公里，即可覆盖一个国家、地区甚至横跨几个洲。常见的例子有我国的公用数字数据网（China DDN）、电话交换网（PSDN）等。广域网是互联网的核心部分，其通信子网主要使用分组交换技术，可以将分布在不同地区的计算机系统互连起来，达到资源共享的目的

##### 1.3.2 按拓扑结构分类

拓扑结构主要是指网络的物理连接形式。常见的拓扑结构有星型、总线型和环型三种。

- 星型拓扑结构是以一台设备作为中央节点，其他外围节点都单独连接在中央节点上。各外围节点之间不能直接通信，必须通过中央节点进行通信。这种结构的优点是结构简单以及便于管理，缺点是安装费用多、可靠性低以及扩充困难。这种结构适用于局域网，主要用双绞线或同轴电缆作为连接线路
- 总线型拓扑结构是将所有节点直接连到一条主干电缆上，这条主干电缆就称为总线。该类结构没有关键性节点，任何一个节点都可以通过主干电缆与连接到总线上的所有节点通信。这种结构的优点是结构简单、可靠性高以及易于扩充，缺点是故障诊断困难，而且总线故障会引起整个网络的瘫痪。这种结构中总线具有信息的双向传输功能，普遍用于局域网的连接，总线一般采用同轴电缆或双绞线
- 环型拓扑结构是各节点形成闭合的环，信息在环中作单向流动，可实现环上任意两节点间的通信。环形结构的优点是电缆长度短、成本低，缺点是当某一节点出现故障时，会引起全网故障，且故障诊断涉及到每一个节点，故障诊断困难。这种结构特别适用于实时控制的局域网系统

##### 1.3.3 按传输介质分类

传输介质是指用于网络连接的通信线路。目前常用的传输介质有同轴电缆、双绞线、光纤、卫星、微波等有线或无线传输介质，相应地可将网络分为同轴电缆网、双绞线网、光纤网、卫星网和无线网。

- 有线网是指采用同轴电缆和双绞线来连接的计算机网络。同轴电缆比较经济，安装便利，传输率和抗干扰能力一般，传输距离较短；双绞线价格便宜，安装方便，但易受干扰，传输率较低，传输距离比同轴电缆要短
- 光纤网采用光导纤维作传输介质。光纤传输距离长，传输率高，抗干扰性强，不会受到电子监听设备的监听，是高安全性网络的理想选择
- 无线网用电磁波作为载体来传输数据

##### 1.3.4 按交换方式分类

按交换方式来分类，计算机网络可以分为电路交换网、报文交换网和分组交换网三种。

- 电路交换（Circuit Switching）最早出现在电话系统中，早期的计算机网络就是采用此方式来传输数据的，用户在开始通信前，必须申请建立一条从发送端到接收端的物理信道，并在双方通信期间始终占用该信道
- 报文交换（Message Switching）是一种数字化网络。当通信开始时，源机发出的一个报文被存储在交换器里，交换器根据报文的目的地址选择合适的路径发送报文，这种方式称做存储转发方式
- 分组交换（Packet Switching）采用报文传输，但它不是以不定长的报文作为传输的基本单位，而是将一个长报文划分为许多定长的分组，以分组作为传输单位。这种方式灵活且传输效率高，已成为计算机网络的主流

#### 1.4 计算机网络性能

##### 1.4.1 速率

速率是指连接在计算机网络上的主机在数字信道上传送数据的速率，也叫数据率（data rate）或比特率（bit rate），单位是 b/s 或 bit/s，也可写为 bps。当速率较高时，可使用 kb/s、Mb/s、Gb/s 或 Tb/s，其中 k = 10<sup>3</sup>、M = 10<sup>6</sup>、G = 10<sup>9</sup> 以及 T = 10<sup>12<sup>。现在一般用更简单而不是很严格的记法来描述网络速率，如 100 M 以太网，意思是速率为 100 Mb/s 的以太网。

##### 1.4.2 带宽

在计算机网络中，带宽表示通信线路传送数据的能力，即单位时间内从网络的某一点到另一点所能通过的最高数据量，其单位与速率的单位一样。这里可能会有很多人把带宽和速率搞混，实际上速率可以说是物理层的概念，其表示的是一段网络线路的物理极限，要进行大幅度的提高难度较大；而带宽除了受到物理层的影响，还受到其他层的影响，其改进可能性较大，所以在实践中，我们通常关心的是带宽。

##### 1.4.3 吞吐量

吞吐量指单位时间内通过某个网络、信道或接口的数据量，其受到网络带宽或额定速率的限制。例如，对于一个 100 Mb/s 的以太网，其额定速率为 100 Mb/s，那么这个数值也是该以太网吞吐量的上限值。

##### 1.4.4 时延

时延指数据（报文或分组）从网络或链路的一端传送到另一端所需要的时间。网络中的时延由以下几部分组成：

- 发送时延：也叫传输时延，是指主机或路由器发送数据帧所需要的时间，即从发送数据帧的第一个比特算起，到该帧最后一个比特发送完所需要的时间。其计算公式为：发送时延 = 数据帧长度 / 发送速率

- 传播时延：指电磁波在信道中传播一定距离所需要的时间，其计算公式为：传播时延 = 信道长度 / 电磁波在信道上的传播速率。对于高速网络链路，我们提高的是带宽值，即发送速率而不是传播速率，因此只有发送时延会减小

- 处理时延：主机或路由器在收到分组时需要花费一定时间进行处理，包括分析分组首部、从分组中提取数据部分、差错检验以及查找适当路由等，这就产生了处理时延

- 排队时延：分组在经过网络传输时，要经过许多路由器，而分组进入路由器后要先在输入队列中排队等待处理。在路由器确定转发接口后，还要在输出队列中排队等待转发，这就是排队时延。排队延时通常取决于网络当时的通信量

数据在网络中的总时延计算公式为：总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延。

##### 1.4.5 时延带宽积

时延带宽积又叫以比特位单位的链路长度，其计算公式为：时延带宽积 = 传播时延 * 带宽。如传播时延为 20 ms，带宽为 10 Mb/s，则时延带宽积等于 2 * 10<sup>5</sup> bit。这表示若发送端连续发送数据，则在发送的第一个比特即将达到终点时，发送端就已经发送了 20 万个比特，这20万个比特都在链路上向前移动。

##### 1.4.6 往返时间 RTT

往返时间 RTT 指从发送方发送数据开始，到收到来自接收方的确认总共经历的时间。另外还有一个指标是往返时间带宽积，即往返时间与带宽的乘积，其意义为从发送方连续发送数据开始，到确认接收时所发送出的比特数。

##### 1.4.7 利用率

利用率包括信道利用率和网络利用率。信道利用率是指信道有百分之几的时间是被利用的，而网络利用率则是全网络信道利用率的加权平均值。信道利用率并非越高越好，因为当某信道利用率增大时，该信道引起的时延也会增加。

#### 1.5 参考模型

##### 1.5.1 ISO/OSI 参考模型 

ISO/OSI 参考模型于 1984 年提出，其在功能上划分为 7 层。从自顶向下的角度看具体如下：

| 名称    | 传输单位         | 意义                           |
| ----- | ------------ | ---------------------------- |
| 应用层   | 报文（message）  | 直接和应用程序接口并提供常见的网络应用服务        |
| 表示层   | 报文（message）  | 为不同终端的上层用户提供数据和信息正确的语法表示变换方法 |
| 会话层   | 报文（message）  | 为两个会话层实体进行会话，而进行的对话连接的管理服务   |
| 传输层   | 报文段（segment） | 为应用进程提供端到端的通信服务              |
| 网络层   | 分组（packet）   | 提供路由和寻址功能，有一定的拥塞控制和流量控制能力    |
| 数据链路层 | 帧（frame）     | 在两个网络实体间提供数据链路连接的创建、维持和释放管理  |
| 物理层   | 比特（bit）      | 确保原始数据可在各种物理媒体上传输            |

##### 1.5.2 TCP/IP 参考模型

TCP/IP 参考模型可以看作是 ISO/OSI 参考模型简化后的版本，是一个四层的模型。它把 ISO/OSI 参考模型的应用层、表示层以及会话层认作模型的应用层，并将数据链路层和物理层合并成网络接口层。从自顶向下的角度看，模型由应用层、传输层、网络互连层以及网络接口层组成。

有时候，我们并不会像 TCP/IP 模型一样，将物理层和数据链路层合并。在这种情况下，我们得到的是一个由应用层、传输层、网络层、数据链路层以及物理层组成的五层模型。在本文中，我们将以五层参考模型为核心进行讲解。

#### 1.6 发展历史

##### 1.6.1 第一代计算机网络

20 世纪 50 年代中后期，许多系统都将地理上分散的多个终端通过通信线路连接到一台中心计算机上，这便是第一代的计算机网络，它是以单个计算机为中心的远程联机系统。

##### 1.6.2 第二代计算机网络

1958 年，美国国防部设立了高级研究计划局（ARPA），以研发用于军事用途的高新科技。1967 年，ARPA 的 Larry Roberts 提出了 ARPANET 构想。1969 年底，ARPANET 正式投入运行。这是世界上第一个运营的分组交换网络，是第二代计算机网络的典型代表，被看作全球互联网的鼻祖。

##### 1.6.3 第三代计算机网络

随着计算机网络技术的成熟，网络应用越来越广泛，网络规模增大，通信变得复杂，各大计算机公司纷纷制定了自己的网络技术标准。1974 年，IBM 推出了系统网络结构（SNA），为用户提供能够互联的成套通信产品；同年，ARPA 的 Robert Kahn 和 斯坦福大学的 Vinton Cerf 提出了 TCP/IP 协议，定义了电脑网络之间传送报文的方法，他们也因此获得 2004 年的图灵奖。1975 年，DEC 公司宣布了自己的数字网络体系结构（DNA）。为了统一网络技术标准，ISO 组织的 TC97 信息处理系统技术委员会 SC16 分技术委员会于 1977 年开始着手制定开放系统互联参考模型，即 OSI/RM，这也标志了第三代计算机网络的诞生。

##### 1.6.4 第四代计算机网络

随着数字通信的出现和光纤的接入，第四代计算机网络正式诞生。1986 年，美国国家科学基金会创建了大学之间互联的骨干网络 NSFNET。1990年，NSFNET 成为国家骨干网，并走出了大学和研究机构，正式进入社会，从此电子邮件、文件下载和信息传输受到人们的欢迎和广泛使用。1992 年，Internet 学会成立。20 世纪 90 年代后期，Internet 以惊人速度发展。

### 第 2 章 物理层

#### 2.1 数据通信的理论基础

##### 2.1.1 数据通信的几个基本概念

**模拟信号和数字信号**

先看两种信号的概念和特点：

- 模拟信号：也叫连续信号。其在时间上连续，包含无穷多个信号值。模拟信号的优势在于系统设备简单以及频带利用率高
- 数字信号：也叫离散信号。其在时间上离散，包括有限数量的信号值。二进制码就是常用的一种数字信号。数字信号的优势在于抗干扰能力强、差错可控以及容易加密

我们熟悉的电视信号就经历了模拟信号到数字信号的发展。数字电视由于其信号损失小和接受效果好的特点而成为了时代的主流。

**基带传输和带通传输**

根据信道中传输的信号是否经过调制，可将传输分为基带传输和带通传输两类。经过调制的传输是带通传输，未经过调制的传输就是基带传输。

基带信号指信源发出的没有经过调制的原始电信号。常见的基带信号有计算机输出的代表各种文字或图像文件的数据信号。基带信号特点是频率较低，在距离较近的传输中，信号衰减问题不大，但在远距离传输中，基带传输则需要进行调制。常见的调制方法包括调幅、调频以及调相。经过调制的信号即为带通信号。

**常见编码方式**

- 不归零制：正电平为 1，负电平为 0
- 归零制：正脉冲为 1，负脉冲为 0
- 曼彻斯特编码：位周期中心向上跳为 0，向下跳为 1，亦可反过来定义
- 差分曼彻斯特编码：在每一位的中心处始终都有跳变，位开始边界有跳变为 0，没有跳变为 1

##### 2.1.2 信道的最大数据速率

奈奎斯特定理和香农定理是两种用来计算信道最大数据速率的方法。

奈奎斯特定理又叫奈式定理，它用来计算理想低通环境下（没有噪声，带宽有限）的信道最大数据速率。设信道带宽为 W，每个码元离散电平数目为 N，则极限数据速率为 $$C=2Wlog_2N$$。当信道传输速率高于此值，则会出现码间干扰的问题。

香农定理则考虑了噪声与信号独立的高斯白噪声信道的最大数据速率。设信道带宽为 W，信号功率为 S，噪声功率为 N，即信噪比为 S/N，则信道的最大数据速率为 $$C=Wlog_2(1+S/N) $$。

#### 2.2 物理层传输介质

##### 2.2.1 导引型传输介质

##### 2.2.2 非导引型传输介质

#### 2.3 多路复用技术

##### 2.3.1 频分复用

##### 2.3.2 时分复用

##### 2.3.3 波分复用

##### 2.3.4 码分复用

### 第 3 章 数据链路层

#### 3.1 数据链路层服务

#### 3.2 差错编码

差错控制主要分为两种：自动重传请求 ARQ 和前向纠错 FEC。前者接收端检测出差错时，就设法通知发送端重传，直至收到正确码字；后者不但能发现差错，还能确定错误位置并进行纠正。因此，差错控制又分为检错编码（Error-Detecting Code）和纠错编码（Error-Correcting Code）。

##### 3.2.1 检错编码

检错编码都是采用冗余编码技术。其核心思想是在有效数据被发送前，先按某种关系附加上一定的冗余位，构成一个符合某一规则的码字后再发送。由于检错编码无法确定哪一位出错，所以它不能进行错误校正。发生错误时必须扔掉全部的数据，然后从头开始传输数据。在噪声很多的媒介上成功传输数据可能要花费很长的时间，甚至根本无法实现。常见的检错编码有累加和校验码、奇偶校验码和循环冗余码，这里主要讲后两者。

**奇偶校验码（Parity Check Code）**

奇偶校验是根据被传输的二进制数据中 1 的个数是奇数或偶数来进行校验。采用奇数的称为奇校验，反之称为偶校验。采用何种校验是事先规定好的。通常专门设置一个奇偶校验位，用它使这组数据中1的个数为奇数或偶数。若用奇校验，则当接收端收到这组数据时，校验 1 的个数是否为奇数，从而确定传输数据的正确性。

奇偶校验分为垂直奇偶校验、水平奇偶校验以及水平垂直奇偶校验。其中前两种检验为单向奇偶校验，只能检验奇数位错误，而水平垂直奇偶检验的校验能力最高，它只有当错误位数为4的倍数才可能无法检测错误，此外，它还能纠正单比特错误。

**循环冗余码（Cyclic Redundancy Code）**

循环冗余吗（CRC）又叫多项式码（Polynomial Code），其本质是模 2 除法的余数。采用的除数不同，得到的循环冗余码也不一样。通常CRC的除数用生成多项式来表示。

如果设计生成多项式得当，那么循环冗余码则变得十分有效，那么我们应该怎样来设计生成多项式 g(x) 呢？

假设加上循环冗余码后传输的码字对应的多项式为 b(x) ，而在传输的过程中出现了错误，对应多项式为 e(x) ，则最终接收端接收到的数据为 r(x) = b(x) + e(x) ，如果 e(x) 刚好是生成多项式 g(x) 与某个数的乘积，那么 r(x) % g(x) 和 b(x) % g(x) 的结果将会一样，这样子将检测不出错误。所以我们要选择好 g(x) 以保证 e(x) 尽可能不是 g(x) 与某个数的乘积，我们分以下几种情况讨论：

1. 1位错误：此时 $$ e(x) = x^i $$。因此只要 g(x) 多于一项，就可以保证 e(x) 无法被整除
2. 2位错误：此时 $$ e(x) = x^i + x^j  = x^i (x^{j-i} + 1) $$，其中 j > i 。当 g(x) 多于一项时，就可以保证 $$ x^i $$ 无法被整除，而当 g(x) 是本原多项式（primitive polynomial，具体概念请自行百度）时，它就不能被 $$ x^{m+1} $$ 整除，其中 $$ m < 2^{n-k-1} $$ ，因此我们需要保证码字长度小于 $$ 2^{n-k-1} $$（n 为最终传输码字长度，k 为原始码字长度）
3. 奇数位错误：为了检测出奇数位错误，我们要保证 g(x) 必须含有 x + 1 这个因式，所以得当的 g(x) 应为 (x + 1) * p(x) ，其中 p(x) 为本原多项式

根据以上的理论，我们引出几个标准CRC生成多项式：

1. CRC-8：$$ x^8 + x^2 + x + 1 $$，应用实例有 ATM
2. CRC-16：$$ x^{16} + x^{15} + x^2 + 1 $$，应用实例有 Bisync
3. CCITT-16：$$ x^{16} + x^{12} + x^5 + 1 $$，应用实例有 HDLC，XMODEM，V.41
4. CCITT-32：$$ x^{32} + x^{26} + x^{23} + x^{22} + x^{16} + x^{12} + x^{11} + x^{10} + x^8 + x^7 + x^5 + x^4 + x^2 + x + 1 $$，应用实例有 IEEE 802，DoD，V.42

##### 3.2.2 纠错编码

**汉明码（Hamming Code）**

汉明码是最为常见的纠错编码，它能发现双比特错，但只能纠正单比特错。汉明码将码字内的位从左至右依次编码（以1为开始），其中编号为2的幂的位（1号位，2号位，4号位，8号位等）是校验位，其余的位填入 m 位数据。 m 个信息位插入 r 个校验位组成 m + r 位码字，它们要满足的关系是$$ 2^r >= m + r + 1 $$。

接下来我们以4位数据编码为例，汉明码将加入3个校验码，从而实际传输7位码字：

数据位：1 2 3 4 5 6 7

代码：P1 P2 D1 P3 D2 D3 D4

说明：Px为校验码，Dx为数据码

现以数据码1101为例讲述汉明码的编码原理：

1. 将数据位标号拆分为2的幂的和，即 1 = 1， 2 = 2， 3 = 1 + 2， 4 = 4， 5 = 1 + 4， 6 = 2 + 4， 7 = 1 + 2 + 4
2. 接着将校验码与和包含其数据位编码的数据位对应，即P1对应数据位1、3、5、7，P2对应2、3、6、7，P3对应4、5、6、7
3. 将对应数据位的数据进行异或运算（同0异1）得到校验位的值，则P1 = 1，P2 = 0，P3 = 0
4. 最后传输的数据为1010101 

#### 3.3 多路访问协议

### 第 4 章 网络层

#### 4.1 网络层服务

网络层主要提供两种服务：

1. 虚电路网络（Virtual-Circuit，VC）：面向连接的通信方式，提供可靠的传输方式，分组总是按顺序到达终点，主要应用于早期的 ATM（Asynchronous Transfer Mode）网络。使用虚拟电路服务主要有虚拟电路建立、数据传送和虚拟电路拆除三个步骤
2. 数据报网络（Datagram Network）：无连接、尽最大努力交付的通信方式，不提供可靠的传输方式，分组不一定按发送顺序到达终点。典型应用是 IP 协议

#### 4.2 网际协议 IP

IP（Internet Protocol）协议是网络层提供数据报网络的常见形式，其具备了数据报网络的无连接、尽最大努力交付、不可靠传输以及不保证分组按顺序到达终点等特点，此外，它还有以下特点：

1. 设置了生成时间 TTL（Time to Live）来表示 IP 数据包的生命周期，防止一个数据包在网络中无限循环地发下去
2. 如果分组太长，IP 协议会对其进行分组
3. 使用了校验和保证了传输到错误目标主机的概率
4. 提供了 32 位的 IPv4 协议和 128 位 IPv6 协议
5. 允许添加新选项到报头

接下来我们分别来看一下 IPv4 协议的报头和 IPv6 协议的报头。

![IPv4协议报头](/redant/images/wiki/ipv4-header.jpg)

IPv4 协议的报头如上图，其每个部分的意义如下：

- 版本（Version）：长度为 4 bit，标识目前采用的 IP 协议的版本号，在 IPv4 中为 0100
- 头部长度（Header Length）：长度为 4 bit，描述 IP 头部长度。IP 头部长度以 4 字节为单位，当此值为默认值时，即 0101，则报文总长度为 5 * 4 字节 = 20 字节
- 服务类型（Type of Service）：长度为 8 bit，只有在使用区分服务时起作用，如果没有，则该字段值为 0
- 总长度（Total Length）：长度为 16 bit，标识整个 IP 数据报的长度，包括报头和数据部分。数据报的长度以 1 字节为单位，所以 IPv4 数据报的最长长度为 $$2^{16} - 1$$ 个字节，即 64 KB
- 标识（Identification）：长度为 16 bit。被分段后的数据报拥有同一标识，以保证最后能正确组装成原来的数据报
- 标志（Flags）：长度为 3 bit。该字段第一位不使用。第二位是 DF（Don’t Fragment）位，为 1 时表明不允许分段。如果无法在不分段的情况下转发，则路由器会丢弃上层数据包并返回错误信息。第三位是 MF（More Fragments）位，除了最后一个分段，其它 IP 包的报头的 MF 位都为 1
- 段偏移（Fragment Offset）：长度为 13 bit，标识该 IP 包在该组分段包中的位置，以 8 个字节为单位
- 生存时间（Time to Live）：长度为 8 bit，默认值为 64，以跳数为单位，每过一个路由器就为减 0，当值为 0 时，则丢弃该分组。此字段避免了 IP 包在路由环路中不断被转发
- 协议（Protocol）：长度为 8 bit，标识上层使用协议。常用的协议号：1 ICMP；2 IGMP；6 TCP；17 UDP；88 IGRP；89 OSPF
- 头部校验和（Header Checksum）：长度为 16 bit。用来做 IP 头部的正确性检测，不包含数据部分。因为 TTL 值会变化，所以数据包每经过一个路由器，校验和都会被重新计算
- 源地址（Source Address）：长度为 32 bit，标识 IP 源地址，除非使用 NAT，否则整个传输过程中，此字段都不会变化
- 目标地址（Destination Address）：长度为 32 bit，标识 IP 目标地址，除非使用 NAT，否则整个传输过程中，此字段都不会变化
- 可选项（Options）：变长字段，可选项，主要用于测试

![IPv6协议报头](/redant/images/wiki/ipv6-header.jpg)

IPv6 协议的报头如上图，其每个部分的意义如下：

- 版本（Version）：长度为 4 bit，标识目前采用的 IP 协议的版本号，在 IPv6 中为 0110
- 流量类别（Traffic Class）：长度为 8 bit，相当于 IPv4 协议中的 ToS 字段，高 6 位标识服务类型，低 2 位用于显式拥塞通知
- 流标签（Flow Label）：长度为 20 bit，有助于避免数据包的重新排序，为流媒体和实时媒体设计
- 有效负载长度（Payload Length）：长度为 16 bit，标识有效载荷中包含多少信息。有效载荷由扩展报头和上层数据组成
- 下一个报头（Next Header）：长度为 8 bit，用来标识下一个报头的类型。此域内定义的类型与 IPv4 中的协议域值相同
- 跳数限制（Hop Limit）：长度为 8 bit，和 IPv4 协议中的 TTL 字段相同
- 源地址（Source Address）：长度为 128 bit，标识 IP 源地址，除非使用 NAT，否则整个传输过程中，此字段都不会变化
- 目标地址（Destination Address）：长度为 128 bit，标识 IP 目标地址，除非使用 NAT，否则整个传输过程中，此字段都不会变化

#### 4.3 网络互联

#### 4.4 路由算法

#### 4.5 网际控制报文协议 ICMP 

ICMP 协议即 Internet 消息控制协议（Internet Control Message Protocol）。由于 IP 协议不提供可靠性且不能保证信息传递，因此发生问题时，发送通知是很重要的，这便促进了 ICMP 协议的诞生。常见的 ping、traceroute 等命令的原理就是 ICMP 协议。

ICMP 消息是在 IP 数据报内部传输的，其传输是不可靠的。ICMP 报文主要可分为差错报文和控制报文：

1. 差错报文：目标不可到达（网络、协议、主机、端口不可到达；禁止分割、目标网络不认识、目标主机不认识等等）、超时、参数问题、重定向（网络重定向、主机重定向等）等
2. 控制报文：请求回显（ping 请求）、回显应答（ping 应答）、地址掩码请求、地址掩码应答等

#### 4.6 虚拟专用网 VPN

#### 4.7 网络地址转换 NAT

### 第 5 章 传输层

#### 5.1 传输层服务

传输层主要提供两种服务：

1. 传输控制协议（Transmission Control Protocol，TCP）：面向连接、面向字节流的传输，传输前需要建立连接，目标主机收到报文后，需要给出确认，传输层向上提供一条可靠全双工的逻辑信道，存在顺序保证、流量控制和拥塞控制，分组首部开销大（20 字节），传输效率低
2. 用户数据报协议（User Datagram Protocol，UDP）：无连接、面向报文的传输，传输前无需建立连接，目标主机收到报文后，无需给出确认，传输层向上提供一条不可靠的逻辑信道，不存在顺序保证、流量控制和拥塞控制，分组首部开销小（8 字节），传输效率高

#### 5.2 用户数据报协议 UDP

![UDP协议报头](/redant/images/wiki/udp-header.jpg)

UDP 协议的报头如上图，其每个部分的意义如下：

- 源端口号（Source Port）：长度为 16 bit，标识源端口号
- 目标端口号（Destination Port）：长度为 16 bit，标识目标端口号
- UDP 长度（UDP Length）：长度为 16 bit，标识整个 UDP 长度，包括报头和数据部分
- UDP 校验和（UDP Checksum）：长度为 16 bit，用来做 UDP 头部的正确性检测，不包含数据部分

#### 5.3 传输控制协议 TCP

##### 5.3.1 TCP 概述

##### 5.3.2 TCP 报文格式

![TCP协议报头](/redant/images/wiki/tcp-header.jpg)

TCP 协议的报头如上图，其每个部分的意义如下：

- 源端口号（Source Port）：长度为 16 bit，标识源端口号
- 目标端口号（Destination Port）：长度为 16 bit，标识目标端口号
- 序列号（Sequence Number）：长度为 32 bit，标识发送报文段的序号值（随机值 + 偏移量），保证发送数据有序且重复数据报被丢弃
- 确认号（Acknowledgement Number）：长度为 32 bit，标识接收方下一次希望接收的报文段的序号值。用来对发送端发送的数据进行确认。当 ACK 标志为 1 时，此字段才有效
- 头部长度（Header Length）：长度为 4 bit，描述 TCP 头部长度。TCP 头部长度以 4 字节为单位，当此值为默认值时，即 0101，则报文总长度为 5 * 4 字节 = 20 字节
- 保留位（Reserved）：长度为 6 bit，保留位，一般置 0，不使用
- URG：长度为 1 bit，紧急标志，标识紧急指针是否有效
- ACK：长度为 1 bit，确认标志，标识确认号是否有效
- PSH：长度为 1 bit，推标志，标识接收方在接收到该报文段后，是否立刻交付给应用层，而不在缓冲区排队
- RST：长度为 1 bit，复位标志，标识是否重置连接
- SYN：长度为 1 bit，同步标志，标识是否发起连接
- FIN：长度为 1 bit，结束标志，表示是否已完成发送任务
- 窗口大小（Window Size）：长度为 16 bit，标识接收方一次期望接收的字节数，用于流量控制
- 校验和（Checksum）：长度为 16 bit，用来做 TCP 头部的正确性检测，不包含数据部分
- 紧急指针（Urgent Pointer）：长度为 16 bit，标识报文段中紧急数据的字节数。当 URG 标志为 1 时，此字段才有效
- 可选项（Options）：变长字段，可选项，主要用于测试

##### 5.3.3 TCP 连接建立

![TCP协议报头](/redant/images/wiki/tcp-handshake.jpg)

TCP 连接建立使用三次握手，具体如下：

1. 第一次握手：客户端主动打开连接，将同步标志 SYN 置为 1，随机初始化一个序号 seq = J，并将该数据包发送给服务器，同时进入 SYN_SENT 状态，等待服务器发回确认报文。TCP 规定，SYN = 1 的报文段不能携带数据，但要消耗掉一个序号
2. 第二次握手：服务器收到数据包后，由同步标志 SYN = 1 知道客户端请求建立连接。于是服务器将同步标志 SYN 和确认标志 ACK 都置为 1，而确认号 ack = J + 1，同时也为自己初始化一个序号 seq = K，并将该数据包发送给客户端以确认连接请求，服务器进入 SYN_RCVD 状态。这个报文同样不携带数据，且要消耗掉一个序号
3. 第三次握手：客户端收到确认后，检查 ack 是否为 J + 1 且确认标志 ACK 是否为1，如果正确则将确认标志 ACK 置为1，ack = K + 1，并将该数据包发送给服务器，服务器检查 ack 是否为 K + 1，ACK 是否为 1，如果正确则连接建立成功，客户端和服务器进入 ESTABLISHED 状态，完成三次握手，随后客户端和服务器之间可以开始传输数据了

##### 5.3.4 TCP 连接释放

![TCP协议报头](/redant/images/wiki/tcp-wavehand.jpg)

TCP 连接释放使用四次挥手，具体如下：

1. 第一次挥手：客户端将结束标志 FIN 置为 1，此时 seq = M，用来关闭客户端到服务器的数据传送，客户端进入 FIN_WAIT_1 状态
2. 第二次挥手：服务器收到数据包后，由同步标志 FIN = 1 知道客户端请求释放连接。于是服务器将确认标志 ACK 都置为 1，而确认号 ack = M + 1，服务器进入 CLOSE_WAIT 状态。客户端收到该报文，会进入 FIN_WAIT_2 状态。此时本次连接就进入了半关闭状态，客户端不再向服务器发送数据。而服务器仍会继续发送
3. 第三次挥手：服务器将结束标志 FIN 置为 1，此时 seq = N，用来关闭服务器到客户端的数据传送，服务器进入 LAST_ACK 状态
4. 第四次挥手：客户端收到数据包后，由同步标志 FIN = 1 知道服务器请求释放连接。于是客户端将确认标志 ACK 都置为 1，而确认号 ack = N + 1，客户端进入 TIME_WAIT 状态。服务器收到该报文，会进入 CLOSED 状态。客户端经过 2MSL（最长报文端寿命）之后，自动进入 CLOSED 状态。

##### 5.3.5 TCP 可靠传输

##### 5.3.6 TCP 流量控制

##### 5.3.7 TCP 拥塞控制

##### 5.3.8 TCP 未来

### 第 6 章 应用层

#### 6.1 万维网

##### 6.1.1 万维网概述

##### 6.1.2 统一资源定位符 URL

##### 6.1.3 超文本传送协议 HTTP

##### 6.1.4 安全套接层 SSL

##### 6.1.5 Web 页面与 Web 应用 

#### 6.2 电子邮件

#### 6.3 域名系统 DNS

##### 6.3.1 域名系统概述

##### 6.3.2 因特网的域名结构

##### 6.3.3 域名服务器

#### 6.4 动态主机配置协议 DHCP

#### 6.5 文件传输

#### 6.6 文件共享

##### 6.6.1 通用网络文件系统 CIFS 

##### 6.6.2 网络文件系统  

#### 6.7 网络时间协议 NTP

#### 6.8 音视频服务

##### 6.8.1 流式音视频

##### 6.8.2 交互式音视频

### 第 7 章 网络安全

#### 7.1 加密模型

##### 7.1.1 对称加密

##### 7.1.2 非对称加密

#### 7.2 数字签名

#### 7.3 报文鉴别

#### 7.4 防火墙